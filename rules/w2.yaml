- id: "W2_ZERO_FED_WITHHOLDING"
  doc_type: "W2"
  description: "Wages are positive but federal withholding is zero."
  condition: "amounts.wages > 0 and amounts.federal_withholding == 0"
  severity: "MEDIUM"
  category: "WITHHOLDING"
  summary: "Wages present with zero federal withholding."
  details: "The document shows wages > 0 but federal income tax withheld is zero."
  suggested_action: "Confirm whether the employer was required to withhold federal income tax."
  citation_hint: "Review IRS Pub 15 and Pub 17 for wage withholding guidance."
  tags: ["W2", "WITHHOLDING", "POTENTIAL_ERROR"]

- id: "W2_SOCSEC_WAGE_CAP"
  doc_type: "W2"
  description: "Social Security wages exceed the annual wage base."
  condition: "amounts.social_security_wages > limits.social_security_wage_base"
  severity: "HIGH"
  category: "LIMITS"
  summary: "Social Security wages exceed wage base."
  details: "Reported Social Security wages exceed the annual wage base limit."
  suggested_action: "Verify that Social Security wages do not exceed the annual wage base; adjust withholding if needed."
  citation_hint: "See IRS Social Security wage base guidance for the applicable year."
  tags: ["W2", "LIMITS", "SOCIAL_SECURITY"]

- id: "W2_SOCSEC_TAX_RATE_MISMATCH"
  doc_type: "W2"
  description: "Social Security tax does not match the expected rate."
  condition: "amounts.social_security_wages > 0 and abs(amounts.social_security_tax - (rates.social_security_rate * amounts.social_security_wages)) > 5"
  severity: "MEDIUM"
  category: "CONSISTENCY"
  summary: "Social Security tax inconsistent with wages."
  details: "Social Security tax withheld deviates from the expected 6.2% of Social Security wages by more than $5."
  suggested_action: "Confirm that Social Security tax withheld matches the statutory rate."
  citation_hint: "Review IRS guidance on Social Security withholding rates."
  tags: ["W2", "CONSISTENCY", "SOCIAL_SECURITY"]

- id: "W2_MEDICARE_TAX_RATE_MISMATCH"
  doc_type: "W2"
  description: "Medicare tax does not match the expected rate."
  condition: "amounts.medicare_wages > 0 and abs(amounts.medicare_tax - (rates.medicare_rate * amounts.medicare_wages)) > 5"
  severity: "MEDIUM"
  category: "CONSISTENCY"
  summary: "Medicare tax inconsistent with wages."
  details: "Medicare tax withheld deviates from the expected 1.45% of Medicare wages by more than $5."
  suggested_action: "Confirm that Medicare tax withheld matches the statutory rate (excluding additional Medicare tax thresholds)."
  citation_hint: "Review IRS guidance on Medicare withholding rates."
  tags: ["W2", "CONSISTENCY", "MEDICARE"]

- id: "W2_MISSING_TAXPAYER_SSN"
  doc_type: "W2"
  description: "Taxpayer SSN is missing or incomplete."
  condition: "stripped(taxpayer.ssn) == '' or stripped(taxpayer.ssn)[8:] == ''"
  severity: "HIGH"
  category: "IDENTIFICATION"
  summary: "Missing or incomplete taxpayer SSN."
  details: "Taxpayer Social Security Number is missing or does not contain at least 9 digits."
  suggested_action: "Request a complete SSN from the taxpayer and update the W-2 record."
  citation_hint: "See IRS W-2 instructions for required taxpayer identification."
  tags: ["W2", "IDENTIFICATION", "POTENTIAL_ERROR"]

- id: "W2_SS_WAGES_MISMATCH"
  doc_type: "W2"
  description: "Social Security wages differ materially from Box 1 wages."
  condition: "amounts.wages > 0 and abs(amounts.social_security_wages - amounts.wages) > 0.01 * amounts.wages and abs(amounts.social_security_wages - amounts.wages) > 10"
  severity: "MEDIUM"
  category: "FICA"
  summary: "Social Security wages differ from Box 1 wages."
  details: "Social Security wages and Box 1 wages differ by more than a small tolerance. This may be due to pre-tax deductions or data issues."
  suggested_action: "Review pre-tax deductions and fringe benefits to confirm that the Social Security wage base is reported correctly."
  citation_hint: "See IRS Pub 15 guidance on Social Security wage calculations."
  tags: ["W2", "FICA", "MISMATCH"]

- id: "W2_EIN_MALFORMED_OR_MISSING"
  doc_type: "W2"
  description: "Employer EIN is missing or not in the expected format."
  condition: "stripped(employer.ein) == '' or stripped(employer.ein)[8:] == ''"
  severity: "HIGH"
  category: "IDENTIFIERS"
  summary: "Employer EIN is missing or malformed."
  details: "Employer EIN is missing or does not follow the expected NN-NNNNNNN pattern."
  suggested_action: "Confirm the employer EIN from source documents or IRS records before filing."
  citation_hint: "Refer to IRS W-2 instructions for EIN reporting requirements."
  tags: ["W2", "IDENTIFIERS", "EIN"]

- id: "W2_FICA_OVER_CAP"
  doc_type: "W2"
  description: "Social Security wages exceed the annual wage base for the tax year."
  condition: "(get(env, \"tax_year\") == 2023 and amounts.social_security_wages > 160200 + 1) or (get(env, \"tax_year\") == 2024 and amounts.social_security_wages > 168600 + 1)"
  severity: "HIGH"
  category: "FICA"
  summary: "Social Security wages exceed annual wage base for the tax year."
  details: "Reported Social Security wages exceed the annual wage base for the tax year. Verify withholding and reporting."
  suggested_action: "Confirm that wages subject to Social Security tax are capped at the annual maximum for the year; adjust if over-reported."
  citation_hint: "See IRS guidance on Social Security wage base limits for the applicable year."
  tags: ["W2", "FICA", "WAGE_BASE"]
